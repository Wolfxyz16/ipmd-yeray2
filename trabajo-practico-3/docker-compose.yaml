# Kafka como almacén de datos temporales
# MariaDB como almacén de datos estructurados
# ElasticSearch como almacén de datos
# Flink como motor de SQL para acceder a distintos almacenes
# Kibana, herramienta de visualización de datos almacenados en ElasticSearch

services:

    mariadb:
      image: mariadb
      container_name: mariadb
      restart: always
      ports:
        - "3306:3306"
      volumes:
        - ./db:/docker-entrypoint-initdb.d/:ro
        - ./data/mbti_labels.csv:/var/lib/mysql/mbti_labels.csv
      environment:
        MYSQL_ROOT_PASSWORD: root
        MYSQL_USER: wolfxyz
        MYSQL_PASSWORD: wolfxyz
        MYSQL_DATABASE: ipmd

    generador:
      build:
        context: .
        dockerfile: generador/Dockerfile
      container_name: generador
      volumes:
        - ./data:/trabajo-practico-3/data

    kafka:
      image: bitnami/kafka
      container_name: kafka
      ports:
        - "9092:9092"
        - "9094:9094"

    jobmanager:
      image: flink:2.0.0-scala_2.12-java21 
      container_name: jobmanager
      ports:
        - "8081:8081"
      command: jobmanager
      environment:
        - |
          FLINK_PROPERTIES=
          jobmanager.rpc.address: jobmanager

    taskmanager:
      image: flink:2.0.0-scala_2.12-java21
      container_name: taskmanager
      depends_on:
        - jobmanager
      command: taskmanager
      environment:
        - |
          FLINK_PROPERTIES=
          jobmanager.rpc.address: jobmanager
          taskmanager.numberOfTaskSlots: 10

    sql-client:
      image: flink:2.0.0-scala_2.12
      command: bin/sql-client.sh
      depends_on:
        - jobmanager
      environment:
        - |
          FLINK_PROPERTIES=
          jobmanager.rpc.address: jobmanager
          rest.address: jobmanager   
